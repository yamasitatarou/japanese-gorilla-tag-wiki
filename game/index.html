<html>
	<head>
		<title>暇つぶし用ミニゲーム！！</title>
<style>
body {
	margin:0;
	text-align:center;
	background-image:url("pc.png");
	overflow:hidden;
	font-family: "fonts";
}
h1 {
	font-size:175%
}
h3 {
	font-size:150%
}
@font-face{
	font-family:"fonts";
	src: url("font.ttf") format("truetype");
}
@media only screen and (max-width:980px) {
	body {
		background-image:url("mobile.png");
		background-size:cover;
		background-attachment:fixed;
	}
	h1{
		font-size:275%;
	}
	h3 {
		font-size:250%;
	}
	#player {
		width:25%;
	}
	#shinyrock {
		width:10%;
	}
}
@media only screen and (min-width:981px) {
	body {
		background-image:url("pc.png");
		background-size:cover;
		color:white;
	}
}
#player {
	position:absolute;
	bottom:0px;
	left:-50px;
}
#welcome {
	z-index:100;
}
#shinyrock {
	position:absolute;
	z-index:-25;
	top:0;
	left:0;
}
</style>
	</head>
	<body>
		<div id=welcome><a href="https://gorillatagwiki.f5.si/"><h1>ミニゲーム！！</a></h1>
			<br>
			<h3>このミニゲームでは上から落ちてくるシャイニーロックを受け止めるゲームです。</h3>
			<br>
			<h3>操作方法はスマホだったら移動したいところをタップ、pcならaとdキーで移動できます</h3>
			<br>
			<h3>移動するゴリラは画面下にいます！そして上にあるミニゲームの文字をタップして</h3>
			<br>
			<h3>ホームページに戻れます</h3>
		</div>
		<br>
		<h1>スコア：<div id=score></div></h1>
		<img src=monke.png width=10% id=player>
		<img src=shiny.png width=5% id=shinyrock>
		<script>
			addEventListener("keydown",movement);
			addEventListener("touchstart",movement);
			var player = document.getElementById("player");
			var shiny = document.getElementById("shinyrock");
			var playerleft = player.getBoundingClientRect().left;
			var shinyleft = shiny.getBoundingClientRect().left;
			var shinytop = shiny.getBoundingClientRect().top;
			var welcome = document.getElementById("welcome");
			var scores = document.getElementById("score");
			var score = 0;
			//score初期化
			scores.innerHTML = `${score}`
			//shinydrop
			shinydrop();
			function shinydrop () {
				var random = Math.floor(Math.random() *91);
				shiny.style.left = random + "%";
				shinytop = 0;
				shiny.style.top = shinytop;
				dropmovement();
			}
			//dropmovementsystem
			function dropmovement () {
				var bodyheight = document.body.getBoundingClientRect().height;
				if (shiny.getBoundingClientRect().top >= bodyheight) {
					welcome.innerHTML = `<h1>ゲームオーバー！！</h1><br><h3>このサイトを更新してまた始める！</h3>`;
				} else {
					shinytop +=3;
					shiny.style.top = shinytop + "%";
					var times = setTimeout(dropmovement,500);
					holdingsystem();
				}
			}
			//holdingsystem
			function holdingsystem () {
				//playerright >= shinyright && playerleft <= shinyright || playerright <= shinyleft && playerleft >= shinyleft
				if(player.getBoundingClientRect().right >= shiny.getBoundingClientRect().right && player.getBoundingClientRect().left <= shiny.getBoundingClientRect().right || player.getBoundingClientRect().right <= shiny.getBoundingClientRect().left && player.getBoundingClientRect().left >= shiny.getBoundingClientRect().left) {
					//playertop <= shinybottom && playerbottom >= shinytop
					if(player.getBoundingClientRect().top <= shiny.getBoundingClientRect().bottom && player.getBoundingClientRect().bottom >= shiny.getBoundingClientRect().bottom) {
						shinydrop();
						score += 1;
						scores.innerHTML = `${score}`;
						clearTimeout(times);
					}
				}
			}
			//playermovementsystem
			function movement(e) {
				if (e.key === "a") {
					playerleft -= 50;
					player.style.left = playerleft + "px";
				} else if (e.key === "d") {
					playerleft += 50;
					player.style.left = playerleft + "px";
				} else  if (e.key === "ArrowLeft") {
					playerleft -= 50;
					player.style.left = playerleft + "px";
				} else if (e.key === "ArrowRight") {
					playerleft += 50;
					player.style.left = playerleft + "px";
				} else if (event.changedTouches[0]) {
					var touchX = event.changedTouches[0].pageX;
					var gorillawidth = player.getBoundingClientRect().width;
					var gorillaes = gorillawidth / 2;
					var zahyou = touchX - gorillaes;
					player.style.left = zahyou;
				}
			}
			//debug
			/*addEventListener("click",() => {
				alert(document.body.getBoundingClientRect().height +  "と" + shiny.getBoundingClientRect().top);
			});
			*/
		</script>
	</body>
</html>
